(window.webpackJsonp=window.webpackJsonp||[]).push([[35],{552:function(s,a,r){"use strict";r.r(a);var e=r(1),t=Object(e.a)({},(function(){var s=this,a=s.$createElement,r=s._self._c||a;return r("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[r("div",{staticClass:"custom-block info"},[r("p",{staticClass:"custom-block-title"},[s._v("联系作者")]),s._v(" "),r("p",[s._v("QQ：1969858717")])]),s._v(" "),r("p",[s._v("私有镜像仓库的部署 Harbor ("),r("strong",[s._v("Docker 部署")]),s._v(")")]),s._v(" "),r("p",[s._v("Harbor 官方网站："),r("a",{attrs:{href:"https://goharbor.io/",target:"_blank",rel:"noopener noreferrer"}},[s._v("https://goharbor.io/"),r("OutboundLink")],1)]),s._v(" "),r("h2",{attrs:{id:"目的"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#目的"}},[s._v("#")]),s._v(" 目的")]),s._v(" "),r("p",[s._v("私有 K8S 平台要使用私有的镜像仓库拉取镜像，而不是使用公共镜像仓库进行拉取。")]),s._v(" "),r("h2",{attrs:{id:"整体步骤"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#整体步骤"}},[s._v("#")]),s._v(" 整体步骤")]),s._v(" "),r("p",[s._v("安装前提：已经安装好 Docker 和 Docker-compose，Harbor 的运行是使用 docker-compose 运行的。")]),s._v(" "),r("p",[s._v("Dokcer 和 Docker-compose 的安装方法："),r("br"),s._v(" "),r("a",{attrs:{href:"https://shenqiangbin.github.io/tech/back/docker/install/",target:"_blank",rel:"noopener noreferrer"}},[s._v("Docker安装"),r("OutboundLink")],1),r("br"),s._v(" "),r("a",{attrs:{href:"https://shenqiangbin.github.io/tech/back/docker/docker-compose/",target:"_blank",rel:"noopener noreferrer"}},[s._v("Docker-compose安装"),r("OutboundLink")],1)]),s._v(" "),r("p",[s._v("安装 Harbor")]),s._v(" "),r("ol",[r("li",[s._v("环境说明")]),s._v(" "),r("li",[s._v("下载安装文件")]),s._v(" "),r("li",[s._v("修改配置文件（修改端口，修改 HTTPS 证书位置）")]),s._v(" "),r("li",[s._v("HTTPS 需要的 SSL 证书的生成")]),s._v(" "),r("li",[s._v("命令行安装")]),s._v(" "),r("li",[s._v("验证")]),s._v(" "),r("li",[s._v("上传镜像")])]),s._v(" "),r("h3",{attrs:{id:"环境说明"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#环境说明"}},[s._v("#")]),s._v(" 环境说明")]),s._v(" "),r("table",[r("thead",[r("tr",[r("th",[s._v("软件")]),s._v(" "),r("th",[s._v("版本")]),s._v(" "),r("th",[s._v("查询命令")])])]),s._v(" "),r("tbody",[r("tr",[r("td",[s._v("系统：")]),s._v(" "),r("td",[s._v("CentOS Linux release 7.9\tcat")]),s._v(" "),r("td",[s._v("/etc/redhat-release")])]),s._v(" "),r("tr",[r("td",[s._v("Docker 版本：")]),s._v(" "),r("td",[s._v("24.0.1")]),s._v(" "),r("td",[s._v("docker version")])]),s._v(" "),r("tr",[r("td",[s._v("Docker-compose 版本：")]),s._v(" "),r("td",[s._v("1.27.4")]),s._v(" "),r("td",[s._v("docker-compose version")])]),s._v(" "),r("tr",[r("td",[s._v("Harbor 版本：")]),s._v(" "),r("td",[s._v("v2.8.1")]),s._v(" "),r("td")])])]),s._v(" "),r("h3",{attrs:{id:"下载安装文件"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#下载安装文件"}},[s._v("#")]),s._v(" 下载安装文件")]),s._v(" "),r("p",[s._v("在网址 "),r("a",{attrs:{href:"https://github.com/goharbor/harbor/releases",target:"_blank",rel:"noopener noreferrer"}},[s._v("https://github.com/goharbor/harbor/releases"),r("OutboundLink")],1),s._v(" 下载如下文件，并上传到服务器上。")]),s._v(" "),r("p",[s._v("或直接下载： "),r("a",{attrs:{href:"https://github.com/goharbor/harbor/releases/download/v2.8.1/harbor-offline-installer-v2.8.1.tgz",target:"_blank",rel:"noopener noreferrer"}},[s._v("https://github.com/goharbor/harbor/releases/download/v2.8.1/harbor-offline-installer-v2.8.1.tgz"),r("OutboundLink")],1)]),s._v(" "),r("p",[r("img",{staticStyle:{width:"800px",border:"1px solid #3eb07c"},attrs:{src:"/assets/tech/harbor-download.png"}})]),s._v(" "),r("h3",{attrs:{id:"修改配置文件"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#修改配置文件"}},[s._v("#")]),s._v(" 修改配置文件")]),s._v(" "),r("p",[s._v("解压 harbor-offline-installer-v2.8.1.tgz 文件，复制一份配置模板文件，并进行配置。")]),s._v(" "),r("div",{staticClass:"language-bash line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-bash"}},[r("code",[r("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 解压")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token function"}},[s._v("tar")]),s._v(" -zxvf harbor-offline-installer-v2.8.1.tgz\n\n"),r("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 进入harbor目录，并复制模板文件")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" harbor "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token function"}},[s._v("cp")]),s._v(" harbor.yml.tmpl harbor.yml\n")])]),s._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[s._v("1")]),r("br"),r("span",{staticClass:"line-number"},[s._v("2")]),r("br"),r("span",{staticClass:"line-number"},[s._v("3")]),r("br"),r("span",{staticClass:"line-number"},[s._v("4")]),r("br"),r("span",{staticClass:"line-number"},[s._v("5")]),r("br")])]),r("p",[s._v("按需修改 harbor.yml 文件")]),s._v(" "),r("p",[s._v("hostname：可以使用 IP 或者域名（推荐使用域名，然后使用 hosts 进行解析）"),r("br"),s._v("\nhttp.port: 访问端口，默认是80"),r("br"),s._v("\nhttps.certificate ：nginx 使用 HTTPS 协议需要的证书"),r("br"),s._v("\nhttps.private_key: nginx 使用 HTTPS 协议需要的私钥"),r("br"),s._v("\nharbor_admin_password：帐号的密码")]),s._v(" "),r("p",[r("strong",[s._v("假设我们域名为：myharbor.com")]),s._v("， 修改示例如下：")]),s._v(" "),r("p",[r("img",{staticStyle:{width:"800px",border:"1px solid #3eb07c"},attrs:{src:"/assets/tech/harbor-config.png"}})]),s._v(" "),r("h3",{attrs:{id:"https-需要的-ssl-证书的生成"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#https-需要的-ssl-证书的生成"}},[s._v("#")]),s._v(" HTTPS 需要的 SSL 证书的生成")]),s._v(" "),r("p",[s._v("（也就是生成上面配置的 /home/harbor/certs/myharbor.com.cert 和 key 文件）"),r("br"),s._v("\n创建一个 certs 目录保存生成的证书，HTTPS 的证书生成也可以称为签发证书，"),r("br"),s._v("\n由于我们的不是真域名，因此我们使用的是自签发证书形式，而不是使用大家公认的颁布机构。")]),s._v(" "),r("p",[s._v("整体步骤："),r("br"),s._v("\n1、生成 CA 私钥"),r("br"),s._v("\n2、生成 CA 证书"),r("br"),s._v("\n3、生成应用证书私钥"),r("br"),s._v("\n4、生成 SAN 文件"),r("br"),s._v("\n5、生成应用证书（用到 CA 私钥、CA 证书、SAN文件、CSR文件）")]),s._v(" "),r("p",[r("strong",[s._v("以下在 certs 目录下执行")])]),s._v(" "),r("p",[s._v("生成 CA 私钥")]),s._v(" "),r("div",{staticClass:"language-sh line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-sh"}},[r("code",[s._v("openssl genrsa -out ca.key "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("4096")]),s._v("\n")])]),s._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[s._v("1")]),r("br")])]),r("p",[s._v("自签发生成 CA 证书")]),s._v(" "),r("div",{staticClass:"language-sh line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-sh"}},[r("code",[s._v("openssl req -x509 -new -nodes -sha512 -days "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("3650")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n-subj "),r("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/C=CN/ST=Beijing/L=Beijing/O=example/OU=Personal/CN=myharbor.com"')]),s._v(" "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n-key ca.key "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n-out ca.crt\n")])]),s._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[s._v("1")]),r("br"),r("span",{staticClass:"line-number"},[s._v("2")]),r("br"),r("span",{staticClass:"line-number"},[s._v("3")]),r("br"),r("span",{staticClass:"line-number"},[s._v("4")]),r("br")])]),r("p",[s._v("注意 CN 后面的 myharbor.com 是我们的服务器域名。")]),s._v(" "),r("p",[s._v("生成应用证书私钥")]),s._v(" "),r("div",{staticClass:"language-sh line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-sh"}},[r("code",[s._v("openssl genrsa -out myharbor.com.key "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("4096")]),s._v("\n")])]),s._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[s._v("1")]),r("br")])]),r("p",[s._v("生成 CSR 文件")]),s._v(" "),r("div",{staticClass:"language-sh line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-sh"}},[r("code",[s._v("openssl req -sha512 -new "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n-subj "),r("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/C=CN/ST=Beijing/L=Beijing/O=example/OU=Personal/CN=myharbor.com"')]),s._v(" "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n-key myharbor.com.key "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n-out myharbor.com.csr\n")])]),s._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[s._v("1")]),r("br"),r("span",{staticClass:"line-number"},[s._v("2")]),r("br"),r("span",{staticClass:"line-number"},[s._v("3")]),r("br"),r("span",{staticClass:"line-number"},[s._v("4")]),r("br")])]),r("p",[s._v("生成 SAN 文件")]),s._v(" "),r("p",[s._v("生成一个ext文本文件，内容就是签发信息，把这些证书签发给哪些目标的域名\n所以harbor的域名必须选择下面的三个域名，签发的证书只对下面三个域名有效")]),s._v(" "),r("div",{staticClass:"language-sh line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-sh"}},[r("code",[r("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" v3.ext "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<<-")]),r("span",{pre:!0,attrs:{class:"token string"}},[s._v("EOF\nauthorityKeyIdentifier=keyid,issuer\nbasicConstraints=CA:FALSE\nkeyUsage = digitalSignature, nonRepudiation, keyEncipherment, dataEncipherment\nextendedKeyUsage = serverAuth\nsubjectAltName = @alt_names\n[alt_names]\nDNS.1=myharbor.com\nDNS.2=www.myharbor.com\nDNS.3=harbor.magedu.local\nEOF")]),s._v("\n")])]),s._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[s._v("1")]),r("br"),r("span",{staticClass:"line-number"},[s._v("2")]),r("br"),r("span",{staticClass:"line-number"},[s._v("3")]),r("br"),r("span",{staticClass:"line-number"},[s._v("4")]),r("br"),r("span",{staticClass:"line-number"},[s._v("5")]),r("br"),r("span",{staticClass:"line-number"},[s._v("6")]),r("br"),r("span",{staticClass:"line-number"},[s._v("7")]),r("br"),r("span",{staticClass:"line-number"},[s._v("8")]),r("br"),r("span",{staticClass:"line-number"},[s._v("9")]),r("br"),r("span",{staticClass:"line-number"},[s._v("10")]),r("br"),r("span",{staticClass:"line-number"},[s._v("11")]),r("br")])]),r("p",[s._v("生成应用证书")]),s._v(" "),r("div",{staticClass:"language-sh line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-sh"}},[r("code",[s._v("openssl x509 -req -sha512 -days "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("3650")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n             -extfile v3.ext "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n             -CA ca.crt -CAkey ca.key -CAcreateserial "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n             -in myharbor.com.csr "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n             -out myharbor.com.crt\n")])]),s._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[s._v("1")]),r("br"),r("span",{staticClass:"line-number"},[s._v("2")]),r("br"),r("span",{staticClass:"line-number"},[s._v("3")]),r("br"),r("span",{staticClass:"line-number"},[s._v("4")]),r("br"),r("span",{staticClass:"line-number"},[s._v("5")]),r("br")])]),r("div",{staticClass:"custom-block info"},[r("p",{staticClass:"custom-block-title"},[s._v("效果")]),s._v(" "),r("div",{staticClass:"language- line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[s._v("[root@10server certs]# openssl x509 -req -sha512 -days 3650 \\\n>              -extfile v3.ext \\\n>              -CA ca.crt -CAkey ca.key -CAcreateserial \\\n>              -in myharbor.com.csr \\\n>              -out myharbor.com.crt\nSignature ok\nsubject=/C=CN/ST=Beijing/L=Beijing/O=example/OU=Personal/CN=myharbor.com\nGetting CA Private Key\n")])]),s._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[s._v("1")]),r("br"),r("span",{staticClass:"line-number"},[s._v("2")]),r("br"),r("span",{staticClass:"line-number"},[s._v("3")]),r("br"),r("span",{staticClass:"line-number"},[s._v("4")]),r("br"),r("span",{staticClass:"line-number"},[s._v("5")]),r("br"),r("span",{staticClass:"line-number"},[s._v("6")]),r("br"),r("span",{staticClass:"line-number"},[s._v("7")]),r("br"),r("span",{staticClass:"line-number"},[s._v("8")]),r("br")])])]),s._v(" "),r("h3",{attrs:{id:"命令行安装"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#命令行安装"}},[s._v("#")]),s._v(" 命令行安装")]),s._v(" "),r("p",[s._v("在解压后的 harbor 目录下运行")]),s._v(" "),r("div",{staticClass:"language- line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[s._v("./install.sh --with-trivy \n")])]),s._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[s._v("1")]),r("br")])]),r("p",[r("img",{staticStyle:{width:"800px",border:"1px solid #3eb07c"},attrs:{src:"/assets/tech/harbor-success.png"}})]),s._v(" "),r("h3",{attrs:{id:"验证"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#验证"}},[s._v("#")]),s._v(" 验证")]),s._v(" "),r("p",[s._v("配置 HOSTS 文件，将域名 myharbor.com 解析到指定服务器。"),r("br"),s._v("\n172.16.1.10 myharbor.com （我的服务器的 IP 是 172.16.1.10）")]),s._v(" "),r("p",[s._v("直接输入 IP 访问也可以。只是会显示不安全。 https://172.16.1.10/")]),s._v(" "),r("p",[r("img",{staticStyle:{width:"800px",border:"1px solid #3eb07c"},attrs:{src:"/assets/tech/harbor-web-ip.png"}})]),s._v(" "),r("p",[s._v("将 myharbor.com.crt 证书下载到电脑上，"),r("strong",[s._v("安装证书")]),s._v("并添加到"),r("strong",[s._v("始终信任")]),s._v("，在浏览器输入 myharbor.com 进行访问浏览。")]),s._v(" "),r("p",[r("img",{staticStyle:{width:"800px",border:"1px solid #3eb07c"},attrs:{src:"/assets/tech/harbor-web.png"}})]),s._v(" "),r("h3",{attrs:{id:"上传镜像"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#上传镜像"}},[s._v("#")]),s._v(" 上传镜像")]),s._v(" "),r("p",[s._v("登录之前，先要配置 hosts。（即使是当前服务器也要配置）"),r("br"),s._v("\n172.16.1.10 myharbor.com")]),s._v(" "),r("p",[s._v("登录\n"),r("code",[s._v("docker login -u admin -p Harbor12345 myharbor.com")])]),s._v(" "),r("p",[s._v("直接去登录的话，会报错。")]),s._v(" "),r("div",{staticClass:"language-sh line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-sh"}},[r("code",[r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@10server harbor"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),r("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# docker login -u admin -p Harbor12345 myharbor.com")]),s._v("\nWARNING"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v(" Using --password via the CLI is insecure. Use --password-stdin.\nError response from daemon: Get "),r("span",{pre:!0,attrs:{class:"token string"}},[s._v('"https://myharbor.com/v2/"')]),r("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" tls: failed to verify certificate: x509: certificate signed by unknown authority\n")])]),s._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[s._v("1")]),r("br"),r("span",{staticClass:"line-number"},[s._v("2")]),r("br"),r("span",{staticClass:"line-number"},[s._v("3")]),r("br")])]),r("p",[s._v("有两种处理办法（选其一即可）："),r("br"),s._v("\n1、跳过 HTTPS 证书认证"),r("br"),s._v("\n2、配置证书")]),s._v(" "),r("h4",{attrs:{id:"方法一-跳过-https-证书认证"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#方法一-跳过-https-证书认证"}},[s._v("#")]),s._v(" 方法一：跳过 HTTPS 证书认证")]),s._v(" "),r("p",[s._v("如果要跳过 HTTPS 的话，配置 编辑 /etc/docker/daemon.json（如果没有此文件，那么就创建一下）")]),s._v(" "),r("div",{staticClass:"language- line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[s._v('{\n"registry-mirrors": [ "http://hub-mirror.c.163.com" ],\n"insecure-registries":["myharbor.com"]\n}\n')])]),s._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[s._v("1")]),r("br"),r("span",{staticClass:"line-number"},[s._v("2")]),r("br"),r("span",{staticClass:"line-number"},[s._v("3")]),r("br"),r("span",{staticClass:"line-number"},[s._v("4")]),r("br")])]),r("p",[s._v("然后重启　dokcer： (注意，如果使用的是 Harbor 服务器，重启之后，注意查看 harbor 相关容器是否启动）")]),s._v(" "),r("div",{staticClass:"language-sh line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-sh"}},[r("code",[r("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" systemctl daemon-reload\n"),r("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" systemctl restart docker\n")])]),s._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[s._v("1")]),r("br"),r("span",{staticClass:"line-number"},[s._v("2")]),r("br")])]),r("p",[s._v("先在 Harbor 的页面上，创建一个 test 项目，然后推送到 test 项目上。")]),s._v(" "),r("div",{staticClass:"language-sh line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-sh"}},[r("code",[s._v("登录\ndocker login -u admin -p Harbor12345 myharbor.com\n\n拉取一个镜像进行测试\ndocker pull hello-world\n\n打上标签\ndocker tag hello-world:latest myharbor.com/test/hello-world:0529\n\n推送\ndocker push myharbor.com/test/hello-world:0529\n")])]),s._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[s._v("1")]),r("br"),r("span",{staticClass:"line-number"},[s._v("2")]),r("br"),r("span",{staticClass:"line-number"},[s._v("3")]),r("br"),r("span",{staticClass:"line-number"},[s._v("4")]),r("br"),r("span",{staticClass:"line-number"},[s._v("5")]),r("br"),r("span",{staticClass:"line-number"},[s._v("6")]),r("br"),r("span",{staticClass:"line-number"},[s._v("7")]),r("br"),r("span",{staticClass:"line-number"},[s._v("8")]),r("br"),r("span",{staticClass:"line-number"},[s._v("9")]),r("br"),r("span",{staticClass:"line-number"},[s._v("10")]),r("br"),r("span",{staticClass:"line-number"},[s._v("11")]),r("br")])]),r("p",[s._v("在浏览器的 Harbor 上查看。")]),s._v(" "),r("h4",{attrs:{id:"方法二-配置证书"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#方法二-配置证书"}},[s._v("#")]),s._v(" 方法二：配置证书")]),s._v(" "),r("p",[s._v("添加证书，证书目录为 /etc/docker/certs.d/myharbor.com ，其中最后一个目录必须为域名名称。")]),s._v(" "),r("div",{staticClass:"custom-block warning"},[r("p",{staticClass:"custom-block-title"},[s._v("注意")]),s._v(" "),r("p",[s._v("certs.d 的下的目录名必须和域名相同")])]),s._v(" "),r("div",{staticClass:"language- line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[s._v("创建目录\nmkdir -p /etc/docker/certs.d/myharbor.com\n\n拷贝证书到此目录\ncp /home/harbor/certs/myharbor.com.crt /etc/docker/certs.d/myharbor.com/\n\n使用上面的逻辑在测试一遍。\ndocker login -u admin -p Harbor12345 myharbor.com\n\n换一个镜像再试一次\ndocker pull busybox\n\ndocker tag busybox:latest myharbor.com/test/busybox:0529\ndocker push myharbor.com/test/busybox:0529\n")])]),s._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[s._v("1")]),r("br"),r("span",{staticClass:"line-number"},[s._v("2")]),r("br"),r("span",{staticClass:"line-number"},[s._v("3")]),r("br"),r("span",{staticClass:"line-number"},[s._v("4")]),r("br"),r("span",{staticClass:"line-number"},[s._v("5")]),r("br"),r("span",{staticClass:"line-number"},[s._v("6")]),r("br"),r("span",{staticClass:"line-number"},[s._v("7")]),r("br"),r("span",{staticClass:"line-number"},[s._v("8")]),r("br"),r("span",{staticClass:"line-number"},[s._v("9")]),r("br"),r("span",{staticClass:"line-number"},[s._v("10")]),r("br"),r("span",{staticClass:"line-number"},[s._v("11")]),r("br"),r("span",{staticClass:"line-number"},[s._v("12")]),r("br"),r("span",{staticClass:"line-number"},[s._v("13")]),r("br"),r("span",{staticClass:"line-number"},[s._v("14")]),r("br")])]),r("p",[s._v("在浏览器的 Harbor 上查看。")]),s._v(" "),r("h2",{attrs:{id:"其它"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#其它"}},[s._v("#")]),s._v(" 其它")]),s._v(" "),r("p",[s._v("containerd 如何配置来访问私有镜像仓库 harbor ？")]),s._v(" "),r("h2",{attrs:{id:"参考"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#参考"}},[s._v("#")]),s._v(" 参考")]),s._v(" "),r("p",[s._v("https://www.cnblogs.com/punchlinux/p/16499966.html")]),s._v(" "),r("p",[s._v("https://goharbor.io/docs/2.8.0/install-config/")]),s._v(" "),r("h2",{attrs:{id:"扩展"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#扩展"}},[s._v("#")]),s._v(" 扩展")]),s._v(" "),r("p",[s._v("关于证书生成中的 CSR 文件")]),s._v(" "),r("h3",{attrs:{id:"csr-文件"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#csr-文件"}},[s._v("#")]),s._v(" CSR 文件")]),s._v(" "),r("p",[s._v("CSR 是 Certificate Signing Request 的缩写，从字面意思可以理解成 证书签发请求。\nCSR 文件是公钥证书原始文件，包含了我们的一些信息，比如服务器信息和单位信息，这些需要提交给 CA 认证中心进行审核。")]),s._v(" "),r("p",[s._v("CSR 文件如何生成？")]),s._v(" "),r("p",[s._v("使用 OpenSSL 工具生成 CSR 文件\n生成命令为："),r("br"),s._v(" "),r("code",[s._v("openssl req -new -nodes -sha256 -newkey rsa:2048 -keyout [$key_file] -out [$OpenSSL_CSR]")])]),s._v(" "),r("p",[s._v("说明："),r("br"),s._v("\n-new：表明生成一个新的 CSR 文件"),r("br"),s._v("\n-nodes：表明密钥文件不被加密"),r("br"),s._v("\n-sha256：使用的sha256算法"),r("br"),s._v("\n-newkey rsa:2048：生成新的私钥文件，且密钥使用 rsa 算法"),r("br"),s._v("\n-keyout $key_file：私钥文件要存放的路径"),r("br"),s._v("\n-out $OpenSSL_CSR：CSR文件在存放的路径")]),s._v(" "),r("p",[s._v("执行之后会要求输入一些必要信息："),r("br"),s._v("\nOrganization Name：公司名称"),r("br"),s._v("\nOrganization Unit Name：部门名称"),r("br"),s._v("\nCountry Code：所属国家，中国的是 CN"),r("br"),s._v("\nState or Province：州名或省份名称"),r("br"),s._v("\nLocality：城市名称"),r("br"),s._v("\nCommon Name：申请 SSL 证书的域名"),r("br"),s._v("\nEmail Address：邮箱地址，可不写"),r("br"),s._v("\nA challenge password：密码，可不写")]),s._v(" "),r("p",[s._v("上面这些也可以使用 -subj 参数来指定")]),s._v(" "),r("p",[s._v('-subj "/C=CN/ST=Beijing/L=Beijing/O=example/OU=Personal/CN=magedu.net"')]),s._v(" "),r("p",[s._v("官方介绍： https://www.openssl.org/docs/man3.0/man1/openssl-req.html")]),s._v(" "),r("p",[s._v("示例：")]),s._v(" "),r("div",{staticClass:"language-sh line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-sh"}},[r("code",[s._v("openssl genrsa -out key.pem "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("2048")]),s._v("\nopenssl req -new -key key.pem -out req.pem\n\n等同于：\n\nopenssl req -newkey rsa:2048 -keyout key.pem -out req.pem \n")])]),s._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[s._v("1")]),r("br"),r("span",{staticClass:"line-number"},[s._v("2")]),r("br"),r("span",{staticClass:"line-number"},[s._v("3")]),r("br"),r("span",{staticClass:"line-number"},[s._v("4")]),r("br"),r("span",{staticClass:"line-number"},[s._v("5")]),r("br"),r("span",{staticClass:"line-number"},[s._v("6")]),r("br")])]),r("p",[s._v("同样，当我们的程序要使用 HTTPS 时，也可以使用上面这一套来操作。")])])}),[],!1,null,null,null);a.default=t.exports}}]);